<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
<head>
    <meta charset='utf-8'>
    <title>Fresco | Caching</title>
    <link rel='stylesheet' href='/static/site.css' type='text/css'/>
    <link rel="stylesheet" href='/static/pygments.css' type='text/css'/>
    <link rel='shortcut icon' href='/static/favicon.png'>
    <meta name='viewport' content='width=480'>
    <meta property="og:title" content="Caching" />
    <meta property="og:site_name" content="fresco">
    <meta property='og:description' content='Fresco is an image management library.'>
    <meta property='og:image' content='http://facebook.github.io/fresco/static/fresco-og-image.png'>
    <meta property='og:url' content="http://facebook.github.io/fresco/docs/caching.html">
    
    <meta property='og:type' content='website'>
    
    <script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script>
    <script type="text/javascript">{'try{Typekit.load();}catch(e){}'}</script>
    <!-- Google Analytics -->
</head>
<body>

<header class='topbar'><nav class='width'>
<a href='/'>
  <img src="/static/fresco-logo.png" class="logo">
</a>
    <ul>
      <li><a href="/docs/index.html#_"
          
          class="active" >
          文档
      </a></li>
      <li><a href="/"
          >
          关于
      </a></li>
      <li><a href="/support.html"
          >
          支持
      </a></li>
      <li><a href="/javadoc">
          API
      </a></li>
      <li><a href="http://github.com/facebook/fresco">GitHub</a>
    </ul>
</nav></header>


<section class='content'><div class='width'>

<nav class='toc'>
  
    <section>
      <h3>配置和使用</h3>
      <ul>
        
          <li>
            <a href="/docs/download-fresco.html#_">
              下载
            </a>
            
          </li>
        
          <li>
            <a href="/docs/index.html#_">
              配置和开始使用
            </a>
            
          </li>
        
          <li>
            <a href="/docs/concepts.html#_">
              关键概念
            </a>
            
          </li>
        
          <li>
            <a href="/docs/supported-uris.html#_">
              支持的 URIs
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>Drawee 指南</h3>
      <ul>
        
          <li>
            <a href="/docs/using-drawees-xml.html#_">
              在XML中使用 Drawees
            </a>
            
          </li>
        
          <li>
            <a href="/docs/using-drawees-code.html#_">
              在Java代码中使用 Drawees
            </a>
            
          </li>
        
          <li>
            <a href="/docs/drawee-components.html#_">
              Drawee的各种效果配置
            </a>
            
          </li>
        
          <li>
            <a href="/docs/scaling.html#_">
              缩放
            </a>
            
          </li>
        
          <li>
            <a href="/docs/rounded-corners-and-circles.html#_">
              圆角/圆圈
            </a>
            
          </li>
        
          <li>
            <a href="/docs/using-controllerbuilder.html#_">
              使用ControllerBuilder
            </a>
            
          </li>
        
          <li>
            <a href="/docs/progressive-jpegs.html#_">
              渐进式JPEG图
            </a>
            
          </li>
        
          <li>
            <a href="/docs/animations.html#_">
              动画图(gif)
            </a>
            
          </li>
        
          <li>
            <a href="/docs/requesting-multiple-images.html#_">
              批量图片请求
            </a>
            
          </li>
        
          <li>
            <a href="/docs/listening-download-events.html#_">
              监听下载事件
            </a>
            
          </li>
        
          <li>
            <a href="/docs/resizing-rotating.html#_">
              缩放和旋转
            </a>
            
          </li>
        
          <li>
            <a href="/docs/modifying-image.html#_">
              图片的修改
            </a>
            
          </li>
        
          <li>
            <a href="/docs/image-requests.html#_">
              图片请求
            </a>
            
          </li>
        
          <li>
            <a href="/docs/writing-custom-views.html#_">
              自定义View
            </a>
            
          </li>
        
          <li>
            <a href="/docs/gotchas.html#_">
              一些陷进
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>Image Pipeline 指南</h3>
      <ul>
        
          <li>
            <a href="/docs/intro-image-pipeline.html#_">
              什么是Image Pipeline
            </a>
            
          </li>
        
          <li>
            <a href="/docs/configure-image-pipeline.html#_">
              Image Pipeline的配置
            </a>
            
          </li>
        
          <li>
            <a href="/docs/caching.html#_" class="active">
              缓存的行为控制
            </a>
            
          </li>
        
          <li>
            <a href="/docs/using-image-pipeline.html#_">
              直接使用Image Pipeline
            </a>
            
          </li>
        
          <li>
            <a href="/docs/datasources-datasubscribers.html#_">
              数据源/订阅数据源
            </a>
            
          </li>
        
          <li>
            <a href="/docs/closeable-references.html#_">
              Closeable References
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>第三方类库</h3>
      <ul>
        
          <li>
            <a href="/docs/using-other-network-layers.html#_">
              自定义网络加载
            </a>
            
          </li>
        
          <li>
            <a href="/docs/using-other-image-loaders.html#_">
              使用其他的Image Loader
            </a>
            
          </li>
        
      </ul>
    </section>
  
</nav>


<article class='withtoc'>
    <h1>
      Caching
      <a class="edit-page-link" href="https://github.com/facebook/fresco/tree/gh-pages/docs/02-caching.md" target="_blank">Edit on GitHub</a>
    </h1>
    <p></p>

    <h3>The three caches</h3>

<h4>1. Bitmap cache</h4>

<p>The bitmap cache stores Android <code>Bitmap</code> objects. These are fully decoded images ready for display or <a href="modifying-image.html">postprocessing</a>. </p>

<p>On Android 4.x and lower, the bitmap cache&#39;s data lives in the <em>ashmem</em> heap, not in the Java heap. This means that images don&#39;t force extra runs of the garbage collector, slowing down your app.</p>

<p>Android 5.0 has much improved memory management than earlier versions, so it is safer to leave the bitmap cache on the Java heap.</p>

<p>When your app is backgrounded, the bitmap cache is emptied.</p>

<h4>2. Encoded memory cache</h4>

<p>This cache stores images in their original compressed form. Images retrieved from this cache must be decoded before display. </p>

<p>If other transformations, such as <a href="resizing-rotating.html">resizing, rotating</a> or <a href="#webp">transcoding</a> were requested, that happens before decode.</p>

<p>This cache is also emptied when your app is backgrounded.</p>

<h4>3. Disk cache</h4>

<p>(Yes, we know phones don&#39;t have disks, but it&#39;s too tedious to keep saying <em>local storage cache</em>...)</p>

<p>Like the encoded memory cache, this cache stores compressed image, which must be decoded and sometimes transformed before display.</p>

<p>Unlike the others, this cache is not cleared when your app is backgrounded, or if it exits, or even if the device is turned off. The user can, of course, always clear it from Android&#39;s Settings menu.</p>

<h3>Using one disk cache or two?</h3>

<p>Most apps need only a single disk cache. But in some circumstances you may want to keep smaller images in a separate cache, to prevent them from getting evicted too soon by larger images.</p>

<p>To do this, just call both <code>setMainDiskCacheConfig</code> and <code>setSmallImageDiskCacheConfig</code> methods when <a href="configure-image-pipeline.html">configuring the image pipeline</a>.</p>

<p>What defines <em>small?</em> Your app does. When <a href="image-requests.html">making an image request</a>, you set its <a href="../javadoc/reference/com/facebook/imagepipeline/request/ImageRequest.ImageType.html">ImageType</a>:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">ImageRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">ImageRequest</span><span class="o">.</span><span class="na">newBuilderWithSourceUri</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setImageType</span><span class="o">(</span><span class="n">ImageType</span><span class="o">.</span><span class="na">SMALL</span><span class="o">)</span>
</code></pre></div>
<p>If you need only one cache, you can simply avoid calling <code>setSmallImageDiskCacheConfig</code>. The pipeline will default to using the same cache for both and <code>ImageType</code> will be ignored.</p>

<h3>Trimming the caches</h3>

<p>When <a href="configure-image-pipeline.html">configuring</a> the image pipeline, you can set the maximum size of each of the caches. But there are times when you might want to go lower than that. For instance, your application might have caches for other kinds of data that might need more space and crowd out Fresco&#39;s. Or you might be checking to see if the device as a whole is running out of storage space.</p>

<p>Fresco&#39;s caches implement the <a href="../javadoc/reference/com/facebook/common/disk/DiskTrimmable.html">DiskTrimmable</a> or <a href="../javadoc/reference/com/facebook/common/memory/MemoryTrimmable.html">MemoryTrimmable</a> interfaces. These are hooks into which your app can tell them to do emergency evictions.</p>

<p>Your application can then configure the pipeline with objects implementing the <a href="../javadoc/reference/com/facebook/common/disk/DiskTrimmableRegistry.html">DiskTrimmableRegistry</a> and <a href="../javadoc/reference/com/facebook/common/memory/MemoryTrimmableRegistry.html">MemoryTrimmableRegistry</a> interfaces. </p>

<p>These objects must keep a list of trimmables. They must use app-specific logic to determine when memory or disk space must be preserved. They then notify the trimmable  objects to carry out their trims.</p>


    <div class="docs-prevnext">
      
        <a href="/docs/configure-image-pipeline.html#_">&larr; 上一页</a>
      
      
        <a class="right" href="/docs/using-image-pipeline.html#_">下一页 &rarr;</a>
      
    </div>

    <a id="_"></a>
</article>

</div></section>
<footer><div class='width'>
    &copy; Copyright 2015, Facebook Inc.
</div></footer>

<script src="/static/linkify.js"></script>
<!-- Google Analytics -->
</body>
</html>

